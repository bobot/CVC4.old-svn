#!/bin/bash
#
# mkkind
# Morgan Deters <mdeters@cs.nyu.edu> for CVC4
# Copyright (c) 2010  The CVC4 Project
#
# The purpose of this script is to create kind.h from a prologue,
# middle, epilogue, and a list of theory kinds.
#
# Invocation:
#
#   mkkind prologue-file middle-file epilogue-file theory-kind-files...
#
# Output is to standard out.
#

cat <<EOF
/*********************                                           -*- C++ -*-  */
/** kind.h
 **
 ** Copyright 2010  The AcSys Group, New York University, and as below.
 **
 ** This header file automatically generated by:
 **
 **     $0 $@
 **
 ** for the CVC4 project.
 **/

EOF

prologue=$1; shift
middle=$1; shift
epilogue=$1; shift

cases=

function special {
  r=$1
  comment=$2

  echo "  $r, /*! $comment */"
  cases="$cases  case $r: out << \"$r\"; break;
"
}

function operator {
  special "$1" "$2"
}

function parameterized {
  special "$1" "$2"
}

function constant {
  special "$1" "$3"
}

cat "$prologue"
while [ $# -gt 0 ]; do
  b=$(basename $(dirname "$1"))
  echo
  echo "  /* from $b */"
  cases="$cases
  /* from $b */
"
  source "$1"
  shift
done
cat "$middle"
echo "$cases"
cat "$epilogue"
