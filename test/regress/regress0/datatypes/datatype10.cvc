% EXPECT: invalid
% EXIT: 10

DATATYPE
  Dn =
    dn0a (tag : BITVECTOR(2), dn0a_rest : Dn1)
  | dn0b (nullt : BITVECTOR(8)),
  Dn1 =
    dn1a (len : BITVECTOR(6), label : (ARRAY BITVECTOR(32) OF BITVECTOR(8)), dn1a_rest : Dn)
  | dn1b (offset : BITVECTOR(14))
END;;
DATATYPE
  state =
    ok (val : (ARRAY BITVECTOR(32) OF BITVECTOR(8)))
  | bottom
END;;
DATATYPE
  cdn_val =
    bv_val_1 (bv_val : BITVECTOR(8))
  | dn_val_0 (dn_val : Dn)
END;;

x : Dn;
w1: BITVECTOR(32);
w2: BITVECTOR(32);
addr_of_n: BITVECTOR(32);
addr_of_p: BITVECTOR(32);
addr_of_cp: BITVECTOR(32);
addr_of_eom: BITVECTOR(32);
q : state;

WordType : TYPE = BITVECTOR(32);
ShortType : TYPE = BITVECTOR(16);
CharType : TYPE = BITVECTOR(8);
MemType : TYPE = ARRAY WordType OF CharType;
StringType : TYPE = ARRAY WordType OF CharType;
SWTType : TYPE = [ StringType, WordType ];

bits_to_dn : SWTType -> Dn;
bits_to_dn1a : SWTType -> Dn1;
bits_to_dn1b : SWTType -> Dn1;

QUERY (LAMBDA (q: state): (is_ok(q) => (LAMBDA (m: (ARRAY
BITVECTOR(32) OF BITVECTOR(8))): (LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): (LET cvc_0 = (0bin000000000000000000000000000000 @
0bin01), cvc_2 = BVPLUS(32, addr_of_p, cvc_0), cvc_1 = BVPLUS(32,
cvc_2, cvc_0), cvc_3 = bits_to_dn((m, (m[BVPLUS(32, cvc_1, cvc_0)] @
(m[cvc_1] @ (m[cvc_2] @ m[addr_of_p]))))) IN NOT (IF (is_dn0a(cvc_3)
AND is_dn1a(dn0a_rest(cvc_3))) THEN 0bin1 ELSE 0bin0 ENDIF =
0bin0)))(val(q)))(val(q))))((LAMBDA (q: state): IF (is_ok(q) =>
(LAMBDA (m: (ARRAY BITVECTOR(32) OF BITVECTOR(8))): (LAMBDA (m: (ARRAY
BITVECTOR(32) OF BITVECTOR(8))): (LET cvc_4 =
(0bin000000000000000000000000000000 @ 0bin01), cvc_6 = BVPLUS(32,
addr_of_n, cvc_4), cvc_5 = BVPLUS(32, cvc_6, cvc_4) IN (((m[BVPLUS(32,
cvc_5, cvc_4)] @ (m[cvc_5] @ (m[cvc_6] @ m[addr_of_n]))) &
SX(0bin011000000,32)) = SX(0bin0,32))))(val(q)))(val(q))) THEN q ELSE
bottom ENDIF)((LAMBDA (q: state): (LET cvc_7 = val(q) IN IF is_ok(q)
THEN ok((cvc_7 WITH [(LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): addr_of_cp)(cvc_7)] := SX((LAMBDA (m: (ARRAY
BITVECTOR(32) OF BITVECTOR(8))): (LET cvc_8 =
(0bin000000000000000000000000000000 @ 0bin01), cvc_10 = BVPLUS(32,
addr_of_cp, cvc_8), cvc_9 = BVPLUS(32, cvc_10, cvc_8) IN BVPLUS(32,
(m[BVPLUS(32, cvc_9, cvc_8)] @ (m[cvc_9] @ (m[cvc_10] @
m[addr_of_cp]))), cvc_8)))(cvc_7),8))) ELSE bottom ENDIF))((LAMBDA (q:
state): IF (is_ok(q) => (LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): (LAMBDA (m: (ARRAY BITVECTOR(32) OF BITVECTOR(8))):
(LET cvc_11 = (0bin000000000000000000000000000000 @ 0bin01), cvc_13 =
BVPLUS(32, addr_of_cp, cvc_11), cvc_12 = BVPLUS(32, cvc_13, cvc_11),
cvc_15 = BVPLUS(32, addr_of_eom, cvc_11), cvc_14 = BVPLUS(32, cvc_15,
cvc_11), cvc_17 = BVPLUS(32, addr_of_n, cvc_11), cvc_16 = BVPLUS(32,
cvc_17, cvc_11) IN NOT (IF (NOT (IF BVLT((m[BVPLUS(32, cvc_12,
cvc_11)] @ (m[cvc_12] @ (m[cvc_13] @ m[addr_of_cp]))),(m[BVPLUS(32,
cvc_14, cvc_11)] @ (m[cvc_14] @ (m[cvc_15] @ m[addr_of_eom])))) THEN
0bin1 ELSE 0bin0 ENDIF = 0bin0) AND NOT (IF NOT ((m[BVPLUS(32, cvc_16,
cvc_11)] @ (m[cvc_16] @ (m[cvc_17] @ m[addr_of_n]))) = SX(0bin0,32))
THEN 0bin1 ELSE 0bin0 ENDIF = 0bin0)) THEN 0bin1 ELSE 0bin0 ENDIF =
0bin0)))(val(q)))(val(q))) THEN q ELSE bottom ENDIF)((LAMBDA (q:
state): (LET cvc_18 = val(q) IN IF is_ok(q) THEN ok((cvc_18 WITH
[(LAMBDA (m: (ARRAY BITVECTOR(32) OF BITVECTOR(8))):
addr_of_n)(cvc_18)] := SX((LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): (LET cvc_19 = (0bin000000000000000000000000000000 @
0bin01), cvc_21 = BVPLUS(32, addr_of_cp, cvc_19), cvc_20 = BVPLUS(32,
cvc_21, cvc_19), cvc_24 = (m[BVPLUS(32, cvc_20, cvc_19)] @ (m[cvc_20]
@ (m[cvc_21] @ m[addr_of_cp]))), cvc_23 = BVPLUS(32, cvc_24, cvc_19),
cvc_22 = BVPLUS(32, cvc_23, cvc_19) IN (m[BVPLUS(32, cvc_22, cvc_19)]
@ (m[cvc_22] @ (m[cvc_23] @ m[cvc_24])))))(cvc_18),8))) ELSE bottom
ENDIF))((LAMBDA (q: state): IF (is_ok(q) => (LAMBDA (m: (ARRAY
BITVECTOR(32) OF BITVECTOR(8))): (LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): (LET cvc_25 = (0bin000000000000000000000000000000 @
0bin01), cvc_27 = BVPLUS(32, addr_of_cp, cvc_25), cvc_26 = BVPLUS(32,
cvc_27, cvc_25), cvc_29 = BVPLUS(32, addr_of_eom, cvc_25), cvc_28 =
BVPLUS(32, cvc_29, cvc_25) IN NOT (IF BVLT((m[BVPLUS(32, cvc_26,
cvc_25)] @ (m[cvc_26] @ (m[cvc_27] @ m[addr_of_cp]))),(m[BVPLUS(32,
cvc_28, cvc_25)] @ (m[cvc_28] @ (m[cvc_29] @ m[addr_of_eom])))) THEN
0bin1 ELSE 0bin0 ENDIF = 0bin0)))(val(q)))(val(q))) THEN q ELSE bottom
ENDIF)((LAMBDA (q: state): (LET cvc_30 = val(q) IN IF is_ok(q) THEN
ok((cvc_30 WITH [(LAMBDA (m: (ARRAY BITVECTOR(32) OF BITVECTOR(8))):
addr_of_n)(cvc_30)] := SX((LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): 0bin0)(cvc_30),8))) ELSE bottom ENDIF))((LAMBDA (q:
state): (LET cvc_31 = val(q) IN IF is_ok(q) THEN ok((cvc_31 WITH
[(LAMBDA (m: (ARRAY BITVECTOR(32) OF BITVECTOR(8))):
addr_of_cp)(cvc_31)] := SX((LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): (LET cvc_32 = (0bin000000000000000000000000000000 @
0bin01), cvc_34 = BVPLUS(32, addr_of_p, cvc_32), cvc_33 = BVPLUS(32,
cvc_34, cvc_32) IN (m[BVPLUS(32, cvc_33, cvc_32)] @ (m[cvc_33] @
(m[cvc_34] @ m[addr_of_p])))))(cvc_31),8))) ELSE bottom
ENDIF))((LAMBDA (q: state): IF (is_ok(q) => (LAMBDA (m: (ARRAY
BITVECTOR(32) OF BITVECTOR(8))): (LAMBDA (m: (ARRAY BITVECTOR(32) OF
BITVECTOR(8))): NOT (0bin01 = SX(0bin0,2)))(val(q)))(val(q))) THEN q
ELSE bottom ENDIF)(q)))))))));
